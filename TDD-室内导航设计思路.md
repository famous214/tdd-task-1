独立开发和测试的前提是进行合理的功能划分与接口设计，从而对一个大的任务和主题进行合理的划分。整个系统分为如下几部分：

+ WiFi传感器部分：负责采集WiFi名与强度信息。

  + 具体设计时可考虑采用Listener方式或者观察者模式（如果后续需要有多个Listener），实现回调，即WiFi强度发生改变时通知上层程序。
  + 则这部分可以实现独立地测试，采用模板方法，第一步调用系统API，数据存到成员变量，第二步从成员变量拿到数据进行解析。这样测试时针对不同平台，第一步的Mock时可以直接set这些成员变量为某个值，然后看第二步解析出的值是否和预期相匹配。
  + 主要测试用例：
    1. 模拟API调用成功返回正确值
    2. 模拟API调用后失败的情况
    3. 模拟API调用后返回一个无效值的情况

+ WiFi强度-距离换算部分：这部分根据收到的WiFi强度信息，采用一定的算法，得出当前距离该WiFi的距离。

  + 这部分的算法是本设计的核心，需要进行一些调研和推导方能得到公式。


  + 这部分在测试时依赖WiFi传感器，但可以通过Mock方法传入一个已事先设定的，输出一定信号强度的假传感器对象，起到测试目的。
  + 主要测试用例就是强、中、弱的WiFi信号，看得出的距离是否符合预期

+ 定位器：根据WiFi坐标信息、换算出的距离信息，得到当前点的坐标。

  + 目前能想到的就是根据各WiFi的坐标和距离，生成若干圆，求各圆的相交区域，取该区域重心位置为目前坐标即可。


  + 测试时可以传入预先设定的经过计算的若干组WiFi坐标和强度数据，看能否得出合理的目标坐标。

+ 地图核心类：用一定的数据结构存储了地图信息，存储某地图并提供相邻点的可达性。

  + 测试时选取一张预先设定的地图信息，然后判断其中某几个相邻点（预先知道可达性）之间的可达性是否与预设相符合。

+ 地图选路算法：吞入加载了地图数据的地图核心类和两个坐标点，生成路径点集。

  + 传入一个Mock的地图核心类，其中某两点之间的可达性预先用某数据结构规划好，然后指定两个预先设计好的坐标，判定输出点集是否符合预期。

+ 路径实时跟踪类：导航开始后，根据路径点集和定位器提供的信息，按照当前位置和路径点集，给出正确的命令（即调用相应的策略）。不同的策略对应语音提示类和地图视图类等的不同行为，用于指导用户行动、提示路线偏离、到达目的地等，如如果判定当前应该向右，则调有向右的策略类，该策略类中handler方法则负责调用语音提示类中相应方法，播放“请右转”，同时调用地图视图类中，在该类上显示诸如右转弯箭头之类的提示等等。

  + 需要注意的是由于WiFi信号的衰减和干扰问题，可能定位器瞬间会出现一个波动值，但人的轨迹应具有连续性，因此不应该出现大幅度的波动。
  + 测试时传入预置的导航点集和Mock的定位器（内置了一组预先设定的轨迹点，每次调用按下标位置返回即可），判定是否符合预期行为（如给出了正确的指令序列，判定是否调用了预期行为的策略类（也是假的策略，其中正确策略的handle方法就是让测试用例通过的语句））

+ 地图视图类：解析地图核心类并绘制地图，由用户在UI上选择终点和已确定的WiFi坐标，根据起点由地图选路算法选路得到的路径点集和路径实时跟踪类得到的路线轨迹进行绘制。

  + 这里的测试如果要实现自动化可能代价比较高，因此采用集成测试的办法。

+ 语音提示类：由实时跟踪类负责调用，播放具体导航指令。